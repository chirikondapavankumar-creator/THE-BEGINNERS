<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>CodeRefine ‚Äî Elite Java Optimizer</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=JetBrains+Mono:wght@300;400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:       #070810;
  --bg2:      #0c0d1a;
  --bg3:      #0f1020;
  --border:   rgba(255,255,255,0.07);
  --bh:       rgba(255,255,255,0.13);
  --gold:     #c9a84c;
  --gold2:    #e8cc80;
  --blue:     #60a5fa;
  --green:    #34d399;
  --purple:   #a78bfa;
  --red:      #f87171;
  --orange:   #fb923c;
  --cyan:     #67e8f9;
  --text:     #f1f3ff;
  --text2:    #8892b0;
  --text3:    #3d4466;
  --error:    #ff6b6b;
}


/* LIGHT THEME */
[data-theme="light"] {
  --bg:       #f4f5fb;
  --bg2:      #eaecf5;
  --bg3:      #ffffff;
  --border:   rgba(0,0,0,0.09);
  --bh:       rgba(0,0,0,0.15);
  --text:     #1a1d2e;
  --text2:    #4a5180;
  --text3:    #9198bb;
  --error:    #ef4444;
}

html { scroll-behavior: smooth; }
body {
  font-family: 'Outfit', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed; inset: 0;
  background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
  pointer-events: none; z-index: 0;
}

.amb { position: fixed; pointer-events: none; z-index: 0; border-radius: 50%; filter: blur(1px); }
.amb-1 { top: -20%; left: 50%; transform: translateX(-50%); width: 1000px; height: 700px; background: radial-gradient(ellipse, rgba(96,165,250,0.07) 0%, transparent 65%); }
.amb-2 { bottom: -15%; right: -10%; width: 700px; height: 600px; background: radial-gradient(ellipse, rgba(201,168,76,0.07) 0%, transparent 65%); }
.amb-3 { top: 35%; left: -15%; width: 600px; height: 500px; background: radial-gradient(ellipse, rgba(167,139,250,0.04) 0%, transparent 65%); }

.wrap { position: relative; z-index: 1; max-width: 1400px; margin: 0 auto; padding: 0 2rem; }

header {
  padding: 1.4rem 0;
  border-bottom: 1px solid var(--border);
  position: sticky; top: 0; z-index: 200;
  backdrop-filter: blur(28px) saturate(1.4);
  background: rgba(7,8,16,0.82);
}
[data-theme="light"] header {
  background: rgba(244,245,251,0.90);
}

.nav { display: flex; align-items: center; justify-content: space-between; gap: 1rem; }
.brand { display: flex; align-items: center; gap: 0.85rem; text-decoration: none; }

.brand-icon {
  width: 38px; height: 38px;
  background: linear-gradient(135deg, rgba(201,168,76,0.15), rgba(201,168,76,0.05));
  border: 1px solid rgba(201,168,76,0.35);
  border-radius: 9px;
  display: flex; align-items: center; justify-content: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: 1rem; color: var(--gold);
  box-shadow: 0 0 18px rgba(201,168,76,0.15);
}

.brand-name {
  font-family: 'DM Serif Display', serif;
  font-size: 1.35rem;
  background: linear-gradient(135deg, var(--text) 20%, var(--gold2) 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}

.nav-center { display: flex; align-items: center; gap: 0.4rem; }

.chip {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.64rem; letter-spacing: 0.07em;
  padding: 0.28rem 0.8rem; border-radius: 999px;
  border: 1px solid var(--border); color: var(--text2);
}
.chip.lit { border-color: rgba(201,168,76,0.4); color: var(--gold2); background: rgba(201,168,76,0.08); }

.srv {
  display: flex; align-items: center; gap: 0.5rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.64rem; color: var(--text2);
  padding: 0.35rem 0.9rem;
  border: 1px solid var(--border); border-radius: 999px;
  transition: all 0.4s;
}
.srv.online { border-color: rgba(52,211,153,0.35); color: #6ee7b7; }

.srv-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--text3); transition: all 0.5s; }
.srv-dot.on { background: var(--green); box-shadow: 0 0 7px rgba(52,211,153,0.7); animation: pulse 2s ease-in-out infinite; }

@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.45} }

.hero { padding: 4.5rem 0 3rem; text-align: center; }

.eyebrow {
  display: inline-flex; align-items: center; gap: 0.55rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.68rem; letter-spacing: 0.13em; text-transform: uppercase;
  color: var(--gold); border: 1px solid rgba(201,168,76,0.25);
  background: rgba(201,168,76,0.06); padding: 0.4rem 1rem;
  border-radius: 999px; margin-bottom: 1.8rem;
}
.eyebrow-dot { width:5px;height:5px;border-radius:50%;background:var(--gold);box-shadow:0 0 8px var(--gold);animation:pulse 2s ease-in-out infinite; }

.hero-title {
  font-family: 'DM Serif Display', serif;
  font-size: clamp(2.8rem, 5.8vw, 5rem);
  line-height: 1.08; letter-spacing: -0.03em;
  margin-bottom: 1.3rem; max-width: 860px;
  margin-left: auto; margin-right: auto;
  color: var(--text);
}

.hero-title em {
  font-style: italic;
  background: linear-gradient(135deg, #b8860b 0%, #d4a017 30%, #e8cc80 60%, #c9a84c 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  filter: drop-shadow(0 2px 8px rgba(201,168,76,0.35));
}
[data-theme="light"] .hero-title em {
  background: linear-gradient(135deg, #92650a 0%, #b8860b 35%, #c9a84c 65%, #8B6914 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  filter: drop-shadow(0 1px 4px rgba(146,101,10,0.25));
}

.hero-sub { font-size: 0.98rem; color: var(--text2); font-weight: 300; max-width: 460px; margin: 0 auto 2.2rem; line-height: 1.75; }

.hero-tags {
  display: flex; align-items: center; justify-content: center;
  flex-wrap: wrap; gap: 1.5rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.68rem; color: var(--text3); letter-spacing: 0.04em;
}
.hero-tags span { color: var(--text2); }
.htag { display:flex;align-items:center;gap:0.45rem; }

.editor-shell {
  border-radius: 18px; overflow: hidden;
  border: 1px solid var(--border);
  background: var(--border);
  display: grid; grid-template-columns: 1fr 1fr; gap: 1px;
  box-shadow: 0 0 0 1px rgba(255,255,255,0.02), 0 50px 100px rgba(0,0,0,0.55), 0 0 80px rgba(96,165,250,0.04);
}

@media(max-width: 820px) { .editor-shell { grid-template-columns: 1fr; } }

.pane { background: var(--bg3); display: flex; flex-direction: column; }

.pane-top {
  display: flex; align-items: center; gap: 0.7rem;
  padding: 0.85rem 1.3rem;
  background: var(--bg2); border-bottom: 1px solid var(--border);
}

.dots { display:flex;gap:5px; }
.dot { width:10px;height:10px;border-radius:50%;opacity:.85; }
.dr{background:#ff5f57}.dy{background:#ffbd2e}.dg{background:#28c840}

.pane-fname { flex:1; font-family:'JetBrains Mono',monospace; font-size:0.68rem; letter-spacing:0.04em; color: var(--text3); text-transform: uppercase; }

.tag { font-family:'JetBrains Mono',monospace; font-size:0.6rem; padding:0.2rem 0.6rem; border-radius:4px; border:1px solid; }
.tag-java { color:#7dd3fc; border-color:rgba(125,211,252,0.2); background:rgba(125,211,252,0.05); }
.tag-ai   { color:var(--gold); border-color:rgba(201,168,76,0.25); background:rgba(201,168,76,0.06); }

.btn-copy {
  font-family:'JetBrains Mono',monospace; font-size:0.6rem;
  padding:0.2rem 0.65rem; border-radius:4px;
  border:1px solid var(--bh); background:transparent;
  color:var(--text2); cursor:pointer; transition:all 0.2s; display:none;
}
.btn-copy:hover { color:var(--gold); border-color:rgba(201,168,76,0.45); background:rgba(201,168,76,0.07); }

.code-area {
  flex:1; display:flex; overflow: hidden;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.8rem; line-height: 1.85;
  min-height: 500px;
}

.line-nums {
  width: 46px; flex-shrink: 0;
  background: rgba(0,0,0,0.2);
  border-right: 1px solid var(--border);
  padding: 1.3rem 0;
  text-align: right;
  font-size: 0.68rem; line-height: 1.85;
  color: var(--text3);
  user-select: none; overflow: hidden;
  display: flex; flex-direction: column;
}
.line-nums span { display: block; padding-right: 10px; min-height: 1.85em; }

.code-input-wrap { flex:1; position:relative; display:flex; }

textarea {
  flex:1; width:100%;
  background: transparent;
  border: none; outline: none; resize: none;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.8rem; line-height: 1.85;
  color: #e2e8f5;
  padding: 1.3rem 1.3rem 1.3rem 1rem;
  tab-size: 2; caret-color: var(--gold);
  white-space: pre; overflow-wrap: normal; overflow-x: auto;
}
textarea::placeholder { color: #252840; }

.highlight-output {
  flex:1; overflow: auto;
  padding: 1.3rem 1.3rem 1.3rem 1rem;
  white-space: pre; word-break: normal;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.8rem; line-height: 1.85;
}
.highlight-output.empty { color: #252840; font-style: italic; white-space: pre-wrap; }

.kw  { color: #c792ea; font-weight: 500; }
.ty  { color: #82aaff; }
.str { color: #c3e88d; }
.num { color: #f78c6c; }
.cmt { color: #546e7a; font-style: italic; }
.ann { color: #ffcb6b; }

.lang-bar { display:flex; align-items:center; gap:0.6rem; flex-wrap:wrap; margin-bottom:1.5rem; }
.lang-label { font-family:"JetBrains Mono",monospace; font-size:0.65rem; color:var(--text3); letter-spacing:0.08em; text-transform:uppercase; margin-right:0.4rem; }
.lang-btn { font-family:"JetBrains Mono",monospace; font-size:0.68rem; padding:0.38rem 0.9rem; border-radius:999px; border:1px solid var(--border); background:transparent; color:var(--text2); cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:0.4rem; }
.lang-btn:hover { border-color:var(--bh); color:var(--text); background:rgba(255,255,255,0.04); }
.lang-btn.active { border-color:rgba(201,168,76,0.5); color:var(--gold2); background:rgba(201,168,76,0.1); box-shadow:0 0 12px rgba(201,168,76,0.12); }

.mode-tabs { display:flex; align-items:center; gap:0; margin-bottom:1.2rem; border:1px solid var(--border); border-radius:10px; overflow:hidden; width:fit-content; }
.mode-tab { font-family:'JetBrains Mono',monospace; font-size:0.72rem; letter-spacing:0.06em; padding:0.55rem 1.4rem; border:none; background:transparent; color:var(--text3); cursor:pointer; transition:all 0.2s; text-transform:uppercase; }
.mode-tab:hover { color:var(--text2); background:rgba(255,255,255,0.03); }
.mode-tab.active { background:rgba(201,168,76,0.12); color:var(--gold2); border-bottom:2px solid var(--gold); }
.convert-bar { display:none; align-items:center; gap:0.7rem; margin-bottom:1.2rem; flex-wrap:wrap; }
.convert-bar.show { display:flex; }
.convert-label { font-family:'JetBrains Mono',monospace; font-size:0.65rem; color:var(--text3); letter-spacing:0.08em; text-transform:uppercase; }
.convert-arrow { font-size:1rem; color:var(--gold); }


.theme-toggle {
  width: 34px; height: 34px; border-radius: 8px;
  border: 1px solid var(--border); background: transparent;
  cursor: pointer; font-size: 1rem;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s; color: var(--text2);
}
.theme-toggle:hover { border-color: rgba(201,168,76,0.4); background: rgba(201,168,76,0.07); }

/* AI TUTOR PANEL */
.tutor-overlay {
  position: fixed; inset: 0; z-index: 500;
  background: rgba(0,0,0,0.3);
  opacity: 0; pointer-events: none;
  transition: opacity 0.3s;
}
.tutor-overlay.show { opacity: 1; pointer-events: all; }

.tutor-panel {
  position: fixed; top: 0; right: 0; bottom: 0;
  width: min(480px, 95vw);
  background: var(--bg2);
  border-left: 1px solid var(--border);
  z-index: 501;
  display: flex; flex-direction: column;
  transform: translateX(100%);
  transition: transform 0.38s cubic-bezier(.16,1,.3,1);
  box-shadow: -20px 0 60px rgba(0,0,0,0.15);
}
.tutor-panel.show { transform: translateX(0); }

.tutor-hdr {
  display: flex; align-items: center; gap: 0.8rem;
  padding: 1.2rem 1.5rem;
  border-bottom: 1px solid var(--border);
  background: var(--bg3);
  flex-shrink: 0;
}
.tutor-icon {
  width: 34px; height: 34px; border-radius: 9px;
  background: rgba(167,139,250,0.12);
  border: 1px solid rgba(167,139,250,0.3);
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem;
}
.tutor-hdr-info { flex: 1; }
.tutor-hdr-info h3 { font-size: 0.9rem; font-weight: 600; color: var(--text); }
.tutor-hdr-info p { font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--text3); margin-top: 0.1rem; }
.tutor-close {
  width: 30px; height: 30px; border-radius: 7px;
  border: 1px solid var(--border); background: transparent;
  color: var(--text2); cursor: pointer; font-size: 0.9rem;
  display: flex; align-items: center; justify-content: center; transition: all 0.2s;
}
.tutor-close:hover { background: rgba(255,0,0,0.07); color: #f87171; border-color: rgba(248,113,113,0.3); }

.tutor-body { flex: 1; overflow-y: auto; padding: 1.2rem; display: flex; flex-direction: column; gap: 1.2rem; }

.tutor-loading {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 1rem; flex: 1; color: var(--text3);
  font-family: 'JetBrains Mono', monospace; font-size: 0.72rem;
}
.tutor-ring {
  width: 36px; height: 36px;
  border: 3px solid rgba(167,139,250,0.15);
  border-top-color: #a78bfa;
  border-radius: 50%; animation: rot 0.8s linear infinite;
}

.tutor-section {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 12px; overflow: hidden;
  animation: up 0.35s cubic-bezier(.16,1,.3,1);
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
}
.tutor-section-hdr {
  display: flex; align-items: center; gap: 0.6rem;
  padding: 0.75rem 1.2rem;
  border-bottom: 1px solid var(--border);
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem; letter-spacing: 0.12em;
  text-transform: uppercase; color: var(--gold);
  background: rgba(201,168,76,0.04);
  font-weight: 500;
}
.tutor-section-body {
  padding: 1.1rem 1.2rem;
  font-size: 0.85rem;
  line-height: 2;
  color: var(--text2);
  white-space: pre-wrap;
  letter-spacing: 0.01em;
}
.tutor-section-body p { margin-bottom: 0.6rem; }

/* Style bullet points inside tutor */
.tutor-section-body li,
.tutor-point {
  display: flex;
  gap: 0.5rem;
  padding: 0.35rem 0;
  border-bottom: 1px solid var(--border);
  font-size: 0.83rem;
  line-height: 1.75;
  color: var(--text2);
}
.tutor-section-body li:last-child,
.tutor-point:last-child { border-bottom: none; }

.btn-explain {
  font-family: 'Outfit', sans-serif; font-weight: 600; font-size: 0.88rem;
  padding: 0.82rem 1.8rem; border-radius: 10px;
  border: 1px solid rgba(167,139,250,0.4); background: transparent;
  color: #a78bfa; cursor: pointer;
  display: none; align-items: center; gap: 0.55rem; transition: all 0.2s;
}
.btn-explain:hover { background: rgba(167,139,250,0.08); transform: translateY(-2px); }
.btn-explain:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
.spin-p { width:13px; height:13px; border:2px solid rgba(167,139,250,.2); border-top-color:#a78bfa; border-radius:50%; animation:rot .65s linear infinite; display:none; }

::-webkit-scrollbar { width:5px; height:5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #1e2240; border-radius: 99px; }
::-webkit-scrollbar-thumb:hover { background: #2e3460; }

.pane-bot {
  display:flex; align-items:center; gap:0.6rem;
  padding:0.55rem 1.3rem;
  background: var(--bg2); border-top: 1px solid var(--border);
  font-family:'JetBrains Mono',monospace; font-size:0.62rem; color:var(--text3);
}

.ldot { width:5px;height:5px;border-radius:50%;background:var(--text3);flex-shrink:0;transition:all .3s; }
.ldot.on { background:var(--gold); box-shadow:0 0 7px var(--gold); animation:pulse 1.4s ease-in-out infinite; }

.actions { display:flex; align-items:center; justify-content:center; gap:0.9rem; padding:1.8rem 0; }

.btn-clear {
  font-family:'Outfit',sans-serif; font-weight:500; font-size:0.85rem;
  padding:0.8rem 1.5rem; border-radius:10px;
  border:1px solid var(--border); background:transparent;
  color:var(--text2); cursor:pointer; transition:all .2s;
}
.btn-clear:hover { border-color:var(--bh); color:var(--text); background:rgba(255,255,255,0.03); }

.btn-main {
  position:relative; overflow:hidden;
  font-family:'Outfit',sans-serif; font-weight:700; font-size:0.95rem;
  padding:0.88rem 2.5rem; border-radius:10px; border:none; cursor:pointer;
  background:linear-gradient(135deg, #a07830 0%, var(--gold2) 45%, #c8a045 100%);
  color:#06040a;
  display:flex; align-items:center; gap:0.6rem;
  box-shadow: 0 0 32px rgba(201,168,76,0.28), 0 4px 24px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.22);
  transition:all .25s;
}
.btn-main::before { content:''; position:absolute; inset:0; background:linear-gradient(135deg,rgba(255,255,255,.18),transparent); opacity:0; transition:opacity .2s; }
.btn-main:hover::before { opacity:1; }
.btn-main:hover { transform:translateY(-2px); box-shadow:0 0 55px rgba(201,168,76,.42), 0 8px 32px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.22); }
.btn-main:active { transform:none; }
.btn-main:disabled { opacity:.55; cursor:not-allowed; transform:none; box-shadow:none; }

.spin { width:15px; height:15px; border:2px solid rgba(0,0,0,.18); border-top-color:#06040a; border-radius:50%; animation:rot .65s linear infinite; display:none; flex-shrink:0; }
@keyframes rot { to { transform:rotate(360deg); } }

.kbd { display:flex;align-items:center;gap:.35rem;font-family:'JetBrains Mono',monospace;font-size:.62rem;color:var(--text3); }
kbd { background:var(--bg2);border:1px solid var(--bh);border-radius:4px;padding:.12rem .4rem;font-family:'JetBrains Mono',monospace;font-size:.6rem;color:var(--text2); }

.imp { display:none; margin-bottom:2.5rem; animation:up .4s cubic-bezier(.16,1,.3,1); }
.imp.show { display:block; }
@keyframes up { from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:none} }

.imp-card { background:var(--bg3); border:1px solid var(--border); border-left: 2px solid rgba(201,168,76,0.5); border-radius:14px; overflow:hidden; box-shadow:0 20px 50px rgba(0,0,0,.3); }
.imp-hdr { display:flex;align-items:center;gap:.7rem; padding:1rem 1.4rem; background:var(--bg2); border-bottom:1px solid var(--border); }
.imp-ico { width:26px;height:26px;border-radius:6px; background:rgba(201,168,76,.1);border:1px solid rgba(201,168,76,.25); display:flex;align-items:center;justify-content:center; font-size:.75rem;color:var(--gold); }
.imp-hdr h3 { font-family:'JetBrains Mono',monospace;font-size:.68rem; letter-spacing:.1em;text-transform:uppercase;color:var(--gold);font-weight:400; }
.imp-body { padding:1.4rem; font-family:'JetBrains Mono',monospace;font-size:.76rem; color:var(--text2); line-height:1.95; white-space:pre-wrap; }

.err { display:none;align-items:center;gap:.7rem; background:rgba(255,107,107,.07);border:1px solid rgba(255,107,107,.22); border-radius:10px;padding:.9rem 1.3rem; margin-bottom:1.4rem;font-size:.83rem;color:#fca5a5; animation:up .3s ease; }
.err.show { display:flex; }

footer { border-top:1px solid var(--border); padding:1.8rem 0; margin-top:1.5rem; }
.foot { display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:1rem; }
.foot-brand { font-family:'DM Serif Display',serif;font-size:.95rem; background:linear-gradient(135deg,#fff 0%,var(--gold2) 100%); -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text; }
.foot-info { font-family:'JetBrains Mono',monospace;font-size:.62rem; color:var(--text3);text-align:right;line-height:1.9; }
.foot-info span { color:var(--text2); }
.divider { height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent);margin:.5rem 0; }
</style>
</head>
<body>

<div class="amb amb-1"></div>
<div class="amb amb-2"></div>
<div class="amb amb-3"></div>


<div class="tutor-overlay" id="tutorOverlay" onclick="closeTutor()"></div>
<div class="tutor-panel" id="tutorPanel">
  <div class="tutor-hdr">
    <div class="tutor-icon">üéì</div>
    <div class="tutor-hdr-info">
      <h3>AI Code Tutor</h3>
      <p>LLAMA 3.3 ¬∑ 70B ¬∑ EXPLAINING YOUR CODE</p>
    </div>
    <button class="tutor-close" onclick="closeTutor()">‚úï</button>
  </div>
  <div class="tutor-body" id="tutorBody">
    <div class="tutor-loading">
      <div class="tutor-ring"></div>
      <span>Analyzing your code‚Ä¶</span>
    </div>
  </div>
</div>

<header>
  <div class="wrap">
    <nav class="nav">
      <a class="brand" href="#">
        <div class="brand-icon">&lt;/&gt;</div>
        <span class="brand-name">CodeRefine</span>
      </a>
      <div class="nav-center">
        <span class="chip lit">Editor</span>
        <span class="chip">Refine Any Language</span>
        <span class="chip">LLaMA 3.3 ¬∑ 70B</span>
      </div>
      <button class="theme-toggle" id="themeBtn" onclick="toggleTheme()" title="Toggle theme">üåô</button>
      <div class="srv" id="srv">
        <div class="srv-dot" id="srvDot"></div>
        <span id="srvLabel">Connecting‚Ä¶</span>
      </div>
    </nav>
  </div>
</header>

<div class="wrap">

  <section class="hero">
    <div class="eyebrow"><div class="eyebrow-dot"></div>AI-Powered Code Optimization</div>
    <h1 class="hero-title">Refine your code into<br><em>production-grade</em> masterwork.</h1>
    <p class="hero-sub">Paste code in any language. Our AI refactors it into clean, optimized, production-grade code ‚Äî in the same language.</p>
    <div class="hero-tags">
      <div class="htag">‚¨° <span>Clean Code</span></div>
      <div class="htag">‚óà <span>Big-O Optimization</span></div>
      <div class="htag">‚óé <span>Any Language</span></div>
      <div class="htag">‚ú¶ <span>Groq ¬∑ Ultra-Fast</span></div>
    </div>
  </section>

  <div class="err" id="errBox">
    <span>‚ö†</span><span id="errMsg">Cannot reach server at localhost:3000.</span>
  </div>

  <div class="mode-tabs">
    <button class="mode-tab active" id="tabRefine" onclick="setMode('refine')">‚ú¶ Refine</button>
    <button class="mode-tab" id="tabConvert" onclick="setMode('convert')">‚áÑ Convert</button>
  </div>

  <div class="convert-bar" id="convertBar">
    <span class="convert-label">Convert from:</span>
    <button class="lang-btn from-btn" data-lang="Python" onclick="setFromLang(this)">üêç Python</button>
    <button class="lang-btn from-btn" data-lang="Java" onclick="setFromLang(this)">‚òï Java</button>
    <button class="lang-btn from-btn" data-lang="JavaScript" onclick="setFromLang(this)">üü® JavaScript</button>
    <button class="lang-btn from-btn" data-lang="TypeScript" onclick="setFromLang(this)">üî∑ TypeScript</button>
    <button class="lang-btn from-btn" data-lang="C++" onclick="setFromLang(this)">‚öô C++</button>
    <button class="lang-btn from-btn" data-lang="C#" onclick="setFromLang(this)">üîµ C#</button>
    <button class="lang-btn from-btn" data-lang="Go" onclick="setFromLang(this)">üêπ Go</button>
    <button class="lang-btn from-btn" data-lang="Rust" onclick="setFromLang(this)">ü¶Ä Rust</button>
    <span class="convert-arrow">‚Üí</span>
    <span class="convert-label">To:</span>
    <button class="lang-btn to-btn" data-lang="Java" onclick="setToLang(this)">‚òï Java</button>
    <button class="lang-btn to-btn" data-lang="Python" onclick="setToLang(this)">üêç Python</button>
    <button class="lang-btn to-btn" data-lang="JavaScript" onclick="setToLang(this)">üü® JavaScript</button>
    <button class="lang-btn to-btn" data-lang="TypeScript" onclick="setToLang(this)">üî∑ TypeScript</button>
    <button class="lang-btn to-btn" data-lang="C++" onclick="setToLang(this)">‚öô C++</button>
    <button class="lang-btn to-btn" data-lang="C#" onclick="setToLang(this)">üîµ C#</button>
    <button class="lang-btn to-btn" data-lang="Go" onclick="setToLang(this)">üêπ Go</button>
    <button class="lang-btn to-btn" data-lang="Rust" onclick="setToLang(this)">ü¶Ä Rust</button>
  </div>

  <div class="lang-bar" id="langBar">
    <span class="lang-label">Language:</span>
    <button class="lang-btn active" data-lang="auto" onclick="setLang(this)">‚¨° Auto Detect</button>
    <button class="lang-btn" data-lang="Java" onclick="setLang(this)">‚òï Java</button>
    <button class="lang-btn" data-lang="Python" onclick="setLang(this)">üêç Python</button>
    <button class="lang-btn" data-lang="JavaScript" onclick="setLang(this)">üü® JavaScript</button>
    <button class="lang-btn" data-lang="TypeScript" onclick="setLang(this)">üî∑ TypeScript</button>
    <button class="lang-btn" data-lang="C++" onclick="setLang(this)">‚öô C++</button>
    <button class="lang-btn" data-lang="C#" onclick="setLang(this)">üîµ C#</button>
    <button class="lang-btn" data-lang="Go" onclick="setLang(this)">üêπ Go</button>
    <button class="lang-btn" data-lang="Rust" onclick="setLang(this)">ü¶Ä Rust</button>
  </div>

  <section style="margin-bottom:0">
    <div class="editor-shell">

      <div class="pane">
        <div class="pane-top">
          <div class="dots"><div class="dot dr"></div><div class="dot dy"></div><div class="dot dg"></div></div>
          <span class="pane-fname">input ‚Äî any language</span>
          <span class="tag tag-java">Input</span>
        </div>
        <div class="code-area">
          <div class="line-nums" id="lineNums"><span>1</span></div>
          <div class="code-input-wrap">
            <textarea id="codeIn" spellcheck="false"
              placeholder="// Paste any language code here&#10;// Python, C++, JS, C#, etc.&#10;// Press Ctrl+Enter to refine&#10;&#10;def bubble_sort(arr):&#10;    for i in range(len(arr)):&#10;        for j in range(len(arr)-1):&#10;            if arr[j] > arr[j+1]:&#10;                arr[j], arr[j+1] = arr[j+1], arr[j]"></textarea>
          </div>
        </div>
        <div class="pane-bot">
          <div class="ldot" id="inDot"></div>
          <span id="chars">0 chars</span>
          <span style="flex:1"></span>
          <span id="lines">0 lines</span>
        </div>
      </div>

      <div class="pane">
        <div class="pane-top">
          <div class="dots"><div class="dot dr"></div><div class="dot dy"></div><div class="dot dg"></div></div>
          <span class="pane-fname" id="outFname">output (auto-detected)</span>
          <button class="btn-copy" id="cpyBtn" onclick="doCopy()">‚éò Copy</button>
          <span class="tag tag-ai">AI Refined</span>
        </div>
        <div class="code-area">
          <div class="line-nums" id="outLineNums"><span>1</span></div>
          <div class="code-input-wrap">
            <div class="highlight-output empty" id="codeOut">// Your refined code will appear here...
//
// The AI will:
//   ‚Üí Detect your language automatically
//   ‚Üí Apply clean code principles
//   ‚Üí Optimize time & space complexity
//   ‚Üí Add proper documentation comments
//   ‚Üí Refactor structure & naming
//   ‚Üí Handle edge cases</div>
          </div>
        </div>
        <div class="pane-bot">
          <div class="ldot" id="outDot"></div>
          <span id="outStatus">Waiting for input</span>
          <span style="flex:1"></span>
          <span id="outLines"></span>
        </div>
      </div>

    </div>
  </section>

  <div class="actions">
    <button class="btn-clear" onclick="doClear()">‚úï Clear</button>
    <button class="btn-main" id="mainBtn" onclick="doRefine()">
      <span id="btnIco">‚ú¶</span>
      <span id="btnTxt">Refine Code</span>
      <div class="spin" id="spin"></div>
    </button>
    <button class="btn-explain" id="explainBtn" onclick="doExplain()"><span id="eIco">üéì</span><span id="eTxt">Explain Code</span><div class="spin-p" id="eSpin"></div></button>
    <div class="kbd"><kbd>Ctrl</kbd>+<kbd>Enter</kbd></div>
  </div>

  <div class="imp" id="impPanel">
    <div class="imp-card">
      <div class="imp-hdr">
        <div class="imp-ico">‚ú¶</div>
        <h3>Improvements Applied</h3>
      </div>
      <div class="imp-body" id="impBody"></div>
    </div>
  </div>

  <div class="divider"></div>
</div>

<footer>
  <div class="wrap">
    <div class="foot">
      <span class="foot-brand">CodeRefine</span>
      <div class="foot-info">
        <div>Endpoint ¬∑ <span>localhost:3000/refine</span></div>
        <div>Model ¬∑ <span>LLaMA 3.3 ¬∑ 70B via Groq</span></div>
      </div>
    </div>
  </div>
</footer>

<script>
const G = id => document.getElementById(id);
let selectedLang = "auto";
let currentMode = "refine";
let fromLang = "Python";
let toLang = "Java";

function setMode(mode) {
  currentMode = mode;
  document.getElementById("tabRefine").classList.toggle("active", mode === "refine");
  document.getElementById("tabConvert").classList.toggle("active", mode === "convert");
  document.getElementById("convertBar").classList.toggle("show", mode === "convert");
  document.getElementById("langBar").style.display = mode === "refine" ? "" : "none";
  btnTxt.textContent = mode === "refine" ? "Refine Code" : "Convert Code";
  btnIco.textContent = mode === "refine" ? "‚ú¶" : "‚áÑ";
  outFname.textContent = mode === "refine" ? "output (auto-detected)" : "output." + getLangExt(toLang);
}

function setFromLang(btn) {
  document.querySelectorAll(".from-btn").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  fromLang = btn.dataset.lang;
}

function setToLang(btn) {
  document.querySelectorAll(".to-btn").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  toLang = btn.dataset.lang;
  G("outFname").textContent = "output." + getLangExt(toLang);
}

function getLangExt(lang) {
  const ext = {Java:"java",Python:"py",JavaScript:"js",TypeScript:"ts","C++":"cpp","C#":"cs",Go:"go",Rust:"rs"};
  return ext[lang] || lang.toLowerCase();
}


const codeIn      = G('codeIn');
const codeOut     = G('codeOut');
const mainBtn     = G('mainBtn');
const spin        = G('spin');
const btnIco      = G('btnIco');
const btnTxt      = G('btnTxt');
const chars       = G('chars');
const lines       = G('lines');
const outStatus   = G('outStatus');
const outLines    = G('outLines');
const outDot      = G('outDot');
const inDot       = G('inDot');
const srvDot      = G('srvDot');
const srvLabel    = G('srvLabel');
const srv         = G('srv');
const errBox      = G('errBox');
const errMsg      = G('errMsg');
const cpyBtn      = G('cpyBtn');
const impPanel    = G('impPanel');
const impBody     = G('impBody');
const lineNums    = G('lineNums');
const outLineNums = G('outLineNums');

function highlight(code) {
  if (!code) return '';
  let h = code.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  const patterns = [
    { re: /\/\/[^\n]*/g, cls: 'cmt' },
    { re: /\/\*[\s\S]*?\*\//g, cls: 'cmt' },
    { re: /"(?:[^"\\]|\\.)*"/g, cls: 'str' },
    { re: /'(?:[^'\\]|\\.)*'/g, cls: 'str' },
    { re: /@\w+/g, cls: 'ann' },
    { re: /\b(abstract|assert|break|case|catch|class|const|continue|default|do|else|enum|extends|final|finally|for|goto|if|implements|import|instanceof|interface|native|new|package|private|protected|public|record|return|sealed|static|strictfp|super|switch|synchronized|this|throw|throws|transient|try|var|void|volatile|while)\b/g, cls:'kw'},
    { re: /\b(boolean|byte|char|double|float|int|long|short|String|Integer|Double|Float|Long|Boolean|Object|List|Map|Set|Optional|Stream|Arrays|Collections|System|Math|StringBuilder|Exception|RuntimeException|ArrayList|HashMap|LinkedList|Iterator)\b/g, cls:'ty'},
    { re: /\b\d+\.?\d*[fFdDlL]?\b/g, cls: 'num' },
  ];
  const combined = new RegExp(patterns.map(p => `(${p.re.source})`).join('|'), 'gm');
  let result = '', lastIndex = 0, match;
  combined.lastIndex = 0;
  while ((match = combined.exec(h)) !== null) {
    if (match.index > lastIndex) result += h.slice(lastIndex, match.index);
    for (let g = 0; g < patterns.length; g++) {
      if (match[g + 1] !== undefined) {
        result += `<span class="${patterns[g].cls}">${match[g+1]}</span>`;
        break;
      }
    }
    lastIndex = match.index + match[0].length;
  }
  result += h.slice(lastIndex);
  return result;
}

function renderLineNums(container, count) {
  container.innerHTML = Array.from({length: Math.max(count,1)}, (_,i) =>
    `<span>${i+1}</span>`).join('');
}

codeIn.addEventListener('input', () => {
  const v = codeIn.value;
  const lc = v ? v.split('\n').length : 0;
  chars.textContent = v.length.toLocaleString() + ' chars';
  lines.textContent = lc + ' lines';
  inDot.classList.toggle('on', v.length > 0);
  renderLineNums(lineNums, lc);
});

codeIn.addEventListener('scroll', () => { lineNums.scrollTop = codeIn.scrollTop; });

function setLang(btn) {
  document.querySelectorAll(".lang-btn").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  selectedLang = btn.dataset.lang;
  const fname = G("outFname");
  const ext = {Java:"java",Python:"py",JavaScript:"js",TypeScript:"ts","C++":"cpp","C#":"cs",Go:"go",Rust:"rs"};
  fname.textContent = selectedLang === "auto"
    ? "output (auto-detected)"
    : "output." + (ext[selectedLang] || selectedLang.toLowerCase());
}

async function ping() {
  try {
    const ac = new AbortController();
    setTimeout(() => ac.abort(), 2500);
    await fetch('http://localhost:3000/refine', { method:'OPTIONS', signal:ac.signal });
    srvDot.className = 'srv-dot on';
    srvLabel.textContent = 'Server Online';
    srv.className = 'srv online';
  } catch {
    srvDot.className = 'srv-dot';
    srvLabel.textContent = 'Server Offline';
    srv.className = 'srv';
  }
}
ping(); setInterval(ping, 8000);

function setLoading(on) {
  mainBtn.disabled = on;
  spin.style.display = on ? 'block' : 'none';
  btnIco.style.display = on ? 'none' : 'inline';
  btnTxt.textContent = on ? (currentMode === 'refine' ? 'Refining‚Ä¶' : 'Converting‚Ä¶') : (currentMode === 'refine' ? 'Refine Code' : 'Convert Code');
  outDot.classList.toggle('on', on);
  outStatus.textContent = on ? 'AI is analyzing‚Ä¶' : 'Ready';
}

async function doRefine() {
  const code = codeIn.value.trim();
  if (!code) { codeIn.focus(); return; }

  setLoading(true);
  errBox.className = 'err';
  impPanel.className = 'imp';
  codeOut.innerHTML = '<span class="cmt">// Analyzing and refining your code‚Ä¶\n// This usually takes 3‚Äì8 seconds.</span>';
  codeOut.className = 'highlight-output';
  cpyBtn.style.display = 'none';
  document.getElementById('explainBtn').style.display = 'none';
  lastRefinedCode = '';
  outLines.textContent = '';
  renderLineNums(outLineNums, 2);

  try {
    const res = await fetch('http://localhost:3000/refine', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ code, mode: currentMode, language: selectedLang === "auto" ? null : selectedLang, fromLang, toLang })
    });

    if (!res.ok) throw new Error('Server responded ' + res.status);

    const data = await res.json();
    const raw  = data.result || '';

    const marker = '-----IMPROVEMENTS MADE-----';
    const idx    = raw.indexOf(marker);
    const codeSection = (idx !== -1 ? raw.slice(0, idx) : raw).trim();
    const impSection  = idx !== -1 ? raw.slice(idx + marker.length).trim() : '';

    codeOut.innerHTML = highlight(codeSection);
    codeOut.className = 'highlight-output';

    const lc = codeSection.split('\n').length;
    renderLineNums(outLineNums, lc);
    outLines.textContent = lc + ' lines';
    outStatus.textContent = 'Refinement complete ‚úì';
    outDot.classList.remove('on');
    cpyBtn.style.display = 'block';
    lastRefinedCode = codeSection;
    document.getElementById('explainBtn').style.display = 'flex';
    srvDot.className = 'srv-dot on';
    srvLabel.textContent = 'Server Online';
    srv.className = 'srv online';

    if (impSection) {
      impBody.textContent = impSection;
      impPanel.className = 'imp show';
    }

  } catch (err) {
    const msg = (err.message.includes('fetch') || err.message.includes('Failed'))
      ? 'Cannot reach server at localhost:3000. Make sure your Java server is running.'
      : 'Error: ' + err.message;
    errMsg.textContent = msg;
    errBox.className = 'err show';
    codeOut.innerHTML = '<span class="cmt">// Refinement failed.\n// Check that your Java server is running on port 3000.</span>';
    codeOut.className = 'highlight-output';
    outStatus.textContent = 'Failed';
    srvDot.className = 'srv-dot';
    srvLabel.textContent = 'Server Offline';
    srv.className = 'srv';
    renderLineNums(outLineNums, 2);
  } finally {
    setLoading(false);
  }
}

function doCopy() {
  const text = codeOut.innerText || codeOut.textContent;
  navigator.clipboard.writeText(text).then(() => {
    cpyBtn.textContent = '‚úì Copied!';
    setTimeout(() => cpyBtn.textContent = '‚éò Copy', 2000);
  });
}

function doClear() {
  codeIn.value = '';
  codeOut.innerHTML = '// Your refined code will appear here...\n//\n// The AI will:\n//   \u2192 Convert any language to Java\n//   \u2192 Apply clean code principles\n//   \u2192 Optimize time &amp; space complexity\n//   \u2192 Add professional Javadoc\n//   \u2192 Refactor structure &amp; naming\n//   \u2192 Handle edge cases';
  codeOut.className = 'highlight-output empty';
  chars.textContent = '0 chars';
  lines.textContent = '0 lines';
  outStatus.textContent = 'Waiting for input';
  btnTxt.textContent = currentMode === 'refine' ? 'Refine Code' : 'Convert Code';
  outLines.textContent = '';
  errBox.className = 'err';
  impPanel.className = 'imp';
  cpyBtn.style.display = 'none';
  document.getElementById('explainBtn').style.display = 'none';
  lastRefinedCode = '';
  inDot.classList.remove('on');
  outDot.classList.remove('on');
  renderLineNums(lineNums, 1);
  renderLineNums(outLineNums, 1);
}


// THEME
let isDark = false;
function toggleTheme() {
  isDark = !isDark;
  document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
  document.getElementById('themeBtn').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
}

// TUTOR
let lastRefinedCode = '';

function openTutor() {
  document.getElementById('tutorOverlay').classList.add('show');
  document.getElementById('tutorPanel').classList.add('show');
  document.body.style.overflow = 'hidden';
}
function closeTutor() {
  document.getElementById('tutorOverlay').classList.remove('show');
  document.getElementById('tutorPanel').classList.remove('show');
  document.body.style.overflow = '';
}

async function doExplain() {
  if (!lastRefinedCode) return;
  const btn = document.getElementById('explainBtn');
  const ico = document.getElementById('eIco');
  const txt = document.getElementById('eTxt');
  const sp  = document.getElementById('eSpin');

  btn.disabled = true;
  sp.style.display = 'block';
  ico.style.display = 'none';
  txt.textContent = 'Explaining‚Ä¶';

  document.getElementById('tutorBody').innerHTML = `
    <div class="tutor-loading">
      <div class="tutor-ring"></div>
      <span>Analyzing your refined code‚Ä¶</span>
    </div>`;
  openTutor();

  try {
    const res = await fetch('http://localhost:3000/explain', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ code: lastRefinedCode })
    });
    if (!res.ok) throw new Error('Server responded ' + res.status);
    const data = await res.json();
    renderExplanation(data.explanation || '');
  } catch(e) {
    document.getElementById('tutorBody').innerHTML = `
      <div class="tutor-section">
        <div class="tutor-section-hdr"><span>‚ö†</span> Error</div>
        <div class="tutor-section-body">Could not load explanation: ${e.message}\nMake sure your server has a /explain endpoint.</div>
      </div>`;
  } finally {
    btn.disabled = false;
    sp.style.display = 'none';
    ico.style.display = 'inline';
    txt.textContent = 'Explain Code';
  }
}

function renderExplanation(text) {
  const defs = [
    { marker: '##OVERVIEW##',     icon: 'üìã', title: 'Overview' },
    { marker: '##BREAKDOWN##',    icon: 'üîç', title: 'Code Breakdown' },
    { marker: '##IMPROVEMENTS##', icon: '‚ö°', title: 'Why These Changes?' },
    { marker: '##CONCEPTS##',     icon: 'üìö', title: 'Key Concepts' },
    { marker: '##TIPS##',         icon: 'üí°', title: 'Tips to Remember' },
  ];

  let sections = [];
  for (let i = 0; i < defs.length; i++) {
    const { marker, icon, title } = defs[i];
    const start = text.indexOf(marker);
    if (start === -1) continue;
    const contentStart = start + marker.length;
    const nexts = defs.slice(i+1).map(d => text.indexOf(d.marker)).filter(x => x > start);
    const end = nexts.length ? Math.min(...nexts) : text.length;
    const content = text.slice(contentStart, end).trim();
    if (content) sections.push({ icon, title, content });
  }

  if (!sections.length) sections = [{ icon: 'üìã', title: 'Explanation', content: text.trim() }];

  const body = document.getElementById('tutorBody');
  body.innerHTML = sections.map(s => {
    // Format content: split by lines, wrap bullet lines nicely
    const formatted = s.content
      .split('\n')
      .map(line => {
        line = line.trim();
        if (!line) return '';
        if (line.match(/^[-‚Ä¢*]\s/)) {
          return `<div class="tutor-point"><span style="color:var(--gold);flex-shrink:0">‚ñ∏</span><span>${line.slice(2)}</span></div>`;
        }
        if (line.match(/^\d+\.\s/)) {
          const num = line.match(/^(\d+)\.\s/)[1];
          const text = line.replace(/^\d+\.\s/, '');
          return `<div class="tutor-point"><span style="color:var(--gold);font-family:'JetBrains Mono',monospace;font-size:0.7rem;flex-shrink:0;min-width:18px">${num}.</span><span>${text}</span></div>`;
        }
        return `<p style="margin-bottom:0.5rem">${line}</p>`;
      })
      .join('');
    return `
    <div class="tutor-section">
      <div class="tutor-section-hdr"><span>${s.icon}</span> ${s.title}</div>
      <div class="tutor-section-body">${formatted}</div>
    </div>`;
  }).join('');
}

codeIn.addEventListener('keydown', e => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); doRefine(); }
  if (e.key === 'Tab') {
    e.preventDefault();
    const s = codeIn.selectionStart;
    codeIn.value = codeIn.value.slice(0,s) + '  ' + codeIn.value.slice(codeIn.selectionEnd);
    codeIn.selectionStart = codeIn.selectionEnd = s + 2;
  }
});
</script>
</body>
</html>
